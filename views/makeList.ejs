<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    </head>
    <body>
      <div class="row container-fluid">
        <div class="col-8">
            <input type="text" id="search" class="form-control mt-5" placeholder="search"><br>
            <button  class="btn btn-danger form-control" id="button">search</button>
        </div>
        <div class="col-4 mt-5">
            <select class="form-select" id="selectCat">
                <% cats.forEach(cat => {%>
                 <option value="<%= cat.name %>"><%= cat.name %></option>
               <%}) 
               %>
             </select>
             <button class="btn btn-success mt-4" id="category">Add your own category</button>
        </div>

      </div>
      
      <div class="row container-fluid">
      <div id="response" class="row container-fluid p-5 col-8">

      </div>
      <div class="col-4">
        
        <div id="res_div" style="padding-top:44px;display: none;">
            <div id="lists">  </div>
            <div>
                <center><button class="btn btn-success" id="add_to_list">Add List</button></center>
            </div>
        </div>
      

    </div>

    <!-- cat model -->
    <div class="modal" id="myModal" role="dialog">
        <div class="modal-dialog">
        
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header text-center">
              
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" id="close">Close</button>
            </div>
          </div>
          
        </div>
      </div>
     
    </body>
    <script>
let array = [];
let cat_ = "best movies"

$(document).on("click","#button",function(){
    let name = $("#search").val();
    $.ajax({
        url:"/searchMoviesByName",
        method:"post",
        data:{
            movie:name
        },
        success:function(res){
          $("#response").html(res)
        }

    })
})

$(document).on("click",".add",function(){
    let movie_id =$(this).attr("id")
    let name = $(`.title[name=${movie_id}]`).val()
    let poster = $(`.poster[name=${movie_id}]`).val()
    
    $.ajax({
        url:"/addToList",
        method:"post",
        data:{
            id:movie_id,
            name:name,
            poster:poster
        },
        success:function(res){
            $("#res_div").css({"display":"block"})
            $("#lists").append(res)
            array.push({movie_id:movie_id,name:name,poster:poster})
            console.log(array)

        }
    })
})

$(document).on("click","#add_to_list",function(){
    $.ajax({
        url:"/add_this_list",
        method:"post",
        data:{
            "array":JSON.stringify(array),
            "category":cat_
        },
        success:function(){
            alert("list has added bro!")
        }
    })
})

$(document).on("click","#category",function(){
    $("#myModal").modal("show")
    $(".modal-body").html(`
    <div class="text-center">
    <span style="font-size:26px;color:red;">create your own category</span> 
    <form action="/addCategory" method="post" class="mt-3">
    <input type="text" name="category" class="form-control">  
    <input type="submit" class="form-control btn btn-danger mt-3">  
    </div>
    `)
})



$(document).on("click","#close",function(){
    $("#myModal").modal("hide");

})


$(document).on("change","#selectCat",function(){
    cat_ = $(this).val()
    console.log(cat_)
})


    </script>
</html>