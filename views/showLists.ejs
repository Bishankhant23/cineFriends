<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

</head>
<body>
<%- include('partials/header') -%>
<div class="listPageFilter d-flex flex-column justify-content-center align-items-center">
   <span class="mb-2" style="font-size: 25px;">FILTER BY :</span>
    <select class="form-select filters" style="width: 40%;">
    <% cats.forEach(cat => {%>
        <option value="<%= cat.name %>"><%= cat.name %></option>
      <%}) 
      %>  
 </select>
 <a href="/makeList"><button class="btn btn-success mt-4">Add your list</button></a>

</div>
<div class="row px-1" style="width: 100%;border:1px solid red">
    <%  
    movie_list.forEach(list => {%>
     <div  class="col-3 bg px-2" style="position:relative;border-right: 1px solid red;margin-bottom:10px;background-image:url('https://image.tmdb.org/t/p/w185<%=list.movie_ids[0].poster %>');background-repeat: no-repeat;background-size: cover;background-color: rgba(0,0,0,0.8);background-blend-mode: color-dodge;color:white" class="px-5 pt-3">
        <span id="list_by_text">list by: <%= list.user_name%></span>
        <h3 class="mb-4"><%= list.name %></h3>
      <%  
       list.movie_ids.forEach(moviess => {%>
         <div class="d-flex mb-3 justify-content-around ps-4" style="border:1px solid white;overflow: hidden;color:white">
            <div class="d-flex align-items-center" style="font-size: 25px;"><%= moviess.name %></div>
            <img src="https://image.tmdb.org/t/p/w185/<%=moviess.poster  %>" style="width: 77px;height:77px;margin-left:auto">
         </div>
         <!-- <%= moviess.likes %> -->
       <%})%>
      <div class=" mt-5 likesDesign">

       <%= length =0 %>
        <% list.likes.forEach(like => {%>
          <% if(like == user){%>
            <% length = 1 %>
            <%}
          %>
       <%})  %>


       <% if(length == 1){%>
        <i class="fa-solid fa-heart fa-2xl likes" style="color:white"  name="<%= list._id %>" id="<%= list.user_name %>"></i> 
       <%}else{%>
        <i class="fa-regular fa-heart fa-2xl likes" style="color:white"  name="<%= list._id %>" id="<%= list.user_name %>"></i> 
      <%} %>

      
      <div class="total_like"><%=list.likes.length  %></div>
      %>
     </div>

     </div>
    <%})
    %>
 </div>
</body>
<script>
    $(document).on("click",".likes",function(){
   let  _id = $(this).attr("name");
   let username = $(this).attr("id")
 console.log("hii")
   let element = $(this)
    $.ajax({
      url:"/addlikes",
      method:"post",
      data:{
        "username" : username,
        "_id":_id
      },
      success:function(res){
        if(res.statuss==true){
          element.parent().children().eq(1).html(`${res.total_likes}`)
          element.addClass("fa-solid")
          
         
        }else{
          element.parent().children().eq(1).html(`${res.total_likes}`)

          element.removeClass("fa-solid")
          element.addClass("fa-regular")

          
        }
        
      }
    })
  })

  $(document).on("change",".filters",function(){
    let filter_cat = $(this).val();
    $.ajax({
        url:"/filterList",
        method:"post",
        data:{
            cat:filter_cat
        },
        success:function(){
            console.log("hiii")
        }
    })
  })
</script>
